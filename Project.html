<!DOCTYPE html>
<html>
<head>
	
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>New York City School Information Application</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="shortcut icon" type="image/x-icon" href="" />
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
	<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/2.2.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>
    <script src="L.TileLayer.BetterWMS.js"></script>
    <style>
        body {
            padding: 0px;
            margin: 0px;
        }
        html, body, #map {
            height: 90%;
            width: 95%;
            margin-top:20px;
            margin-left:40px;
        }

    </style>
</head>
<body>
<div class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-inner">
            <div class="container-fluid">
                <a class="brand" href="https://github.com/lresh1/ges772">New York City School Information Application</a>
            </div>
        </div>
    </div>
<div id="container" style="display: flex;justify-content: space-between;">
  <div>
    <h2> Select Borough</h2>
    <select type="text "id='sql_input' value="" onchange="load_schooldata(document.getElementById('sql_input').value,document.getElementById('sql_input2').value)">
        <option value="Manhattan','Bronx','Brooklyn','Queens','Staten Island" selected>All Boroughs</option>
        <option value="Bronx">Bronx</option>
        <option value="Brooklyn">Brooklyn</option>
        <option value="Manhattan">Manhattan</option>
        <option value="Queens">Queens</option>
        <option value="Staten Island">Staten Island</option>
    </select>
  </div>
  <div>
    <h2>Select Grades</h2>
    <select type="text "id='sql_input2' value="" onchange="load_schooldata(document.getElementById('sql_input').value,document.getElementById('sql_input2').value)">
        <option value="K-12 all grades" selected>K-12 (All Grades)</option>
        <option value="Early Childhood">Early Childhood</option>
        <option value="Elementary">Elementary</option>
        <option value="High school">High School</option>
        <option value="Junior High-Intermediate-Middle">Junior High-Intermediate-Middle</option>
        <option value="K-8">K-8</option>
        <option value="Secondary School">Secondary School</option>
        <option value="Ungraded">Ungraded</option>
    </select>
  </div>  
  <div>
    <h2>Select Proficiency</h2>
    <select type="text "id='sql_input3' value="" onchange="load_schooldata(document.getElementById('sql_input').value,document.getElementById('sql_input2').value)">
        <option value="Manhattan','Bronx','Brooklyn','Queens','Staten Island" selected>---</option>
    </select>
  </div>
</div>


      <div id="map"></div>

      <script type="text/javascript">

  var Jawg_Dark = L.tileLayer('https://{s}.tile.jawg.io/jawg-dark/{z}/{x}/{y}{r}.png?access-token={accessToken}', {
    attribution: '<a href="http://jawg.io" title="Tiles Courtesy of Jawg Maps" target="_blank">&copy; <b>Jawg</b>Maps</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
    minZoom: 0,
    maxZoom: 22,
    subdomains: 'abcd',
    accessToken: 'we72s9JUn6MBMOdkCWiW3hIG0X9xDLSeJe3sD67QDsCWZEdO1D1hUvmn1qG2iDhy'

  });
      var map = L.map('map', {
        center: [40.730610, -73.935242],
        zoom: 10,
        layers: Jawg_Dark,
      });

  var schooldata = null;
  window.load_schooldata = function (schoollocationquery,schooltypequery) { 
    if (schoollocationquery == ''){
      query = '1=1';
        }
      if (schooldata != null) {
      map.removeLayer(schooldata);
        }
    schooldata = L.tileLayer.wms('http://localhost:8080/geoserver/GES_772_Project/wms?', {
      layers : 'GES_772_Project:Export_Output',
      transparent : true,
      format : 'image/png',
      cql_filter : "BoroName IN ('" + schoollocationquery + "') AND LOCATION_1 IN ('" + schooltypequery + "')",
      opacity : 1
    }).addTo(map);
};

  var afterschool = L.tileLayer.wms("http://localhost:8080/geoserver/GES_772_Project/wms?", {
      layers: 'AfterSchoolLocations_Final',
      format: 'image/png',
      transparent: true,
      version: '1.1.0',
      attribution: "myattribution"
  });

  var subway = L.tileLayer.wms("http://localhost:8080/geoserver/GES_772_Project/wms?", {
      layers: 'NYC Subways',
      format: 'image/png',
      transparent: true,
      version: '1.1.0',
      attribution: "myattribution"
  });

  var baseMaps = {
      "Dark Basemap": Jawg_Dark
    };


  var overlayMaps = {
      "Subway Locations": subway,
      "After-School Locations": afterschool
    };

      L.control.layers(baseMaps, overlayMaps).addTo(map);

wfsURL = 'http://localhost:8080/geoserver/GES_772_Project/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=GES_772_Project%3AExport_Output&maxFeatures=50&outputFormat=application%2Fjson'

var myStyle = {
    "color": "#ffffff",
    "weight": 5,
    "fillOpacity": 0,
    "opacity": 0

};
window.load_schooldata("");	
// Get GeoJSON data and create features.
  $.getJSON(wfsURL, function(data) {
  
        schooldata = L.geoJson(data, {
        	style: myStyle,
			
           
				onEachFeature: function (feature, layer) {
				
						layer.on('click', function (e) {
 
							// get coordinates from GeoJSON
							var coords = e.target.feature.geometry.coordinates
							//pass coords to function to create marker.(Yellow circle)
							onMapClick(coords);
							
								var field1=document.getElementById('f1');
								field1.innerHTML=e.target.feature.properties.BoroName;

						});

				}
				}).addTo(map);
        });
</script>



</body>
</html>
